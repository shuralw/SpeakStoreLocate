# Copilot Instruktionen für SpeakStoreLocate

## Repository-Zweck
ASP.NET Core 8.0 Microservices-Architektur mit:
- API Service (C#/.NET)
- Angular Frontend
- Docker Containerisierung
- AWS App Runner Deployment
- Azure Container Apps für PR Previews

**Stack:** .NET 8, C#, Angular, Docker, AWS/Azure

## Projektstruktur
```
SpeakStoreLocate/
├── SpeakStoreLocate.ApiService/      # C#/.NET API
│   ├── Controllers/                  # API Endpoints
│   ├── Services/                     # Business Logic
│   ├── Models/                       # Data Models
│   ├── Middleware/                   # Custom Middleware
│   ├── Program.cs                    # Main Entry Point
│   ├── appsettings.*.json            # Konfigurationen
│   └── dockerfile                    # Docker Image
├── SpeakStoreLocate.Client/          # Angular Frontend
├── SpeakStoreLocate.AppHost/         # .NET Aspire AppHost
├── SpeakStoreLocate.ServiceDefaults/ # Gemeinsame Service-Configs
├── SpeakStoreLocate.Tests/           # Unit Tests (xUnit)
├── SpeakStoreLocate.sln              # Solution File
└── scripts/
    └── tmux-dev.sh                   # Development Setup Script
```

## Wichtige Regeln für Copilot

### ✅ Immer tun:
1. **Vor Code-Änderungen:**
   - Build testen: `dotnet build`
   - Tests ausführen: `dotnet test`
   - In lokaler Umgebung debuggen

2. **Bei C# Code:**
   - C# Naming Conventions befolgen (PascalCase für Public Members)
   - async/await für I/O-Operationen nutzen
   - Dependency Injection verwenden (bereits in Program.cs Setup)
   - Error Handling & Logging mit bestehenden Services

3. **Bei API-Änderungen:**
   - Controller-Dokumentation (XML-Comments) aktualisieren
   - CORS-Einstellungen beachten (siehe TROUBLESHOOTING_CORS.md)
   - Bestehende Integration-Tests prüfen

4. **Bei Umgebungs-Configs:**
   - `appsettings.Development.json` für lokale Entwicklung
   - `appsettings.json` für Standard-Einstellungen
   - `appsettings.Production.json` für Production (AWS-spezifisch)
   - **SENSITIVE DATEN NICHT committen** (AWS Keys, Secrets)

5. **Docker & Deployment:**
   - Dockerfile nach Docker-Best-Practices ändern
   - `apprunner.yaml` für AWS-Deployment synchron halten
   - `docker build` testen vor Push

6. **Commits:**
   - Aussagekräftige Messages: `feat: ...`, `fix: ...`, `test: ...`
   - Zusammengehörige Änderungen in einem Commit
   - Getesteter Code: Unit Tests müssen grün sein

### ❌ Nicht tun:
- AWS Keys oder Secrets committen
- Konfigurationsdateien verändern ohne lokales Testen
- Dependency-Versionen wild updaten
- Breaking Changes ohne PR-Diskussion machen
- Unit Tests ignorieren oder überspringen

## Häufige Befehle
```bash
dotnet build                           # Build Solution
dotnet build SpeakStoreLocate.ApiService/  # Einzelnes Project
dotnet test                            # Alle Tests ausführen
dotnet run --project SpeakStoreLocate.ApiService/  # API starten
dotnet test --filter "ClassName"      # Spezifische Tests

# Docker
docker build -t speakstorelocate .
docker run -p 5000:8080 speakstorelocate
```

## Troubleshooting-Dokumentation
Wichtige Dateien lesen bei Problemen:
- `TROUBLESHOOTING_AWS_AUTH.md` - AWS-Authentifizierung
- `TROUBLESHOOTING_CORS.md` - CORS-Fehler
- `TROUBLESHOOTING_CORS_NULL_ORIGIN.md` - Spezielle CORS-Issues
- `TROUBLESHOOTING_URI_FORMAT.md` - URI-Formatierungsprobleme

## PR Preview Environments
- Automatisiert via Azure Container Apps
- Setup in `docs/PR_PREVIEW_SETUP.md`
- Preview-URLs in `docs/PR_PREVIEW_ENVIRONMENTS.md`

## Sicherheit
⚠️ **Nie in Code:**
- AWS Access Keys
- Database Passwords
- API Keys oder Secrets
- Connection Strings mit echten Daten

Nutze stattdessen:
- `appsettings.json` mit Umgebungsvariablen
- `.gitignore` für sensitive Local-Dateien
- AWS Secrets Manager für Produktion
